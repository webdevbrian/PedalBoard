'use strict';Object.defineProperty(exports,'__esModule',{value:true});var U=Object.defineProperty;var z=(r,s,e)=>s in r?U(r,s,{enumerable:true,configurable:true,writable:true,value:e}):r[s]=e;var t=(r,s,e)=>z(r,typeof s!="symbol"?s+"":s,e);var h=class{constructor(){t(this,"events",new Map);t(this,"addEventListener",this.on);t(this,"removeEventListener",this.off);t(this,"dispatchEvent",this.emit);}on(s,e){return this.events.has(s)||this.events.set(s,new Set),this.events.get(s).add(e),this}off(s,e){let i=this.events.get(s);return i&&(i.delete(e),i.size===0&&this.events.delete(s)),this}emit(s,...e){let i=this.events.get(s);return i&&i.forEach(o=>{try{o(...e);}catch(n){console.error(`Error in event listener for ${s}:`,n);}}),this}once(s,e){let i=(...o)=>{this.off(s,i),e(...o);};return this.on(s,i)}removeAllListeners(s){return s?this.events.delete(s):this.events.clear(),this}listenerCount(s){let e=this.events.get(s);return e?e.size:0}};var m=class extends h{constructor(e){super();t(this,"context");t(this,"outputNode");t(this,"source");t(this,"isPlaying",false);this.context=e,this.outputNode=this.context.createGain();}connect(e){"getInput"in e?this.outputNode.connect(e.getInput()):this.outputNode.connect(e);}disconnect(){try{this.outputNode.disconnect();}catch{}}play(){this.isPlaying=true,this.emit("play");}stop(){this.isPlaying=false,this.emit("stop");}getOutput(){return this.outputNode}getIsPlaying(){return this.isPlaying}setVolume(e){e=Math.max(0,Math.min(1,e)),this.outputNode.gain.value=e;}getVolume(){return this.outputNode.gain.value}dispose(){this.stop(),this.disconnect(),this.removeAllListeners();}};var g=class extends m{constructor(e,i){super(e);t(this,"buffer");t(this,"bufferSource");t(this,"startTime",0);t(this,"pauseTime",0);i&&this.loadFile(i);}async loadFile(e){this.emit("loading");try{let o=await(await fetch(e)).arrayBuffer();this.buffer=await this.context.decodeAudioData(o),this.emit("loaded",this.buffer);}catch(i){throw console.error("Failed to load audio file:",i),this.emit("error",i),i}}async loadArrayBuffer(e){this.emit("loading");try{this.buffer=await this.context.decodeAudioData(e),this.emit("loaded",this.buffer);}catch(i){throw console.error("Failed to decode audio data:",i),this.emit("error",i),i}}async loadFileObject(e){let i=await e.arrayBuffer();await this.loadArrayBuffer(i);}play(e=0){if(!this.buffer){console.error("No audio buffer loaded");return}this.stop(),this.bufferSource=this.context.createBufferSource(),this.bufferSource.buffer=this.buffer,this.bufferSource.connect(this.outputNode),this.bufferSource.onended=()=>{this.isPlaying=false,this.emit("ended");};let i=this.pauseTime;this.bufferSource.start(e,i),this.startTime=this.context.currentTime-i,this.isPlaying=true,this.emit("play");}stop(){if(this.bufferSource&&this.isPlaying){try{this.bufferSource.stop(),this.bufferSource.disconnect();}catch{}this.bufferSource=void 0;}this.pauseTime=0,this.isPlaying=false,this.emit("stop");}pause(){this.isPlaying&&this.bufferSource&&(this.pauseTime=this.context.currentTime-this.startTime,this.stop(),this.emit("pause"));}resume(){!this.isPlaying&&this.pauseTime>0&&this.play();}getDuration(){return this.buffer?this.buffer.duration:0}getCurrentTime(){return this.isPlaying?this.context.currentTime-this.startTime:this.pauseTime}seek(e){let i=this.isPlaying;this.stop(),this.pauseTime=Math.max(0,Math.min(e,this.getDuration())),i&&this.play();}setLoop(e){this.bufferSource&&(this.bufferSource.loop=e);}dispose(){this.stop(),this.buffer=void 0,super.dispose();}};var x=class extends m{constructor(e,i=true){super(e);t(this,"stream");t(this,"sourceNode");t(this,"analyser");t(this,"constraints");this.constraints={audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false},video:false},i&&this.startStream();}async startStream(){try{this.emit("requesting"),this.stream=await navigator.mediaDevices.getUserMedia(this.constraints),this.sourceNode=this.context.createMediaStreamSource(this.stream),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=256,this.sourceNode.connect(this.analyser),this.analyser.connect(this.outputNode),this.isPlaying=!0,this.emit("loaded"),this.emit("play");}catch(e){throw console.error("Failed to get audio stream:",e),this.emit("error",e),e}}stop(){if(this.sourceNode){try{this.sourceNode.disconnect();}catch{}this.sourceNode=void 0;}if(this.analyser){try{this.analyser.disconnect();}catch{}this.analyser=void 0;}this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=void 0),this.isPlaying=false,this.emit("stop");}getLevel(){if(!this.analyser||!this.isPlaying)return 0;let e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e);let i=0;for(let o=0;o<e.length;o++)i+=e[o];return i/(e.length*255)}getFrequencyData(){if(!this.analyser)return new Uint8Array(0);let e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteFrequencyData(e),e}getWaveformData(){if(!this.analyser)return new Uint8Array(0);let e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(e),e}setConstraints(e){this.constraints=e;}async restart(){this.stop(),await this.startStream();}static async checkPermission(){try{return (await navigator.permissions.query({name:"microphone"})).state}catch(e){return console.error("Failed to check microphone permission:",e),"prompt"}}static async getAudioDevices(){try{return (await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="audioinput")}catch(e){return console.error("Failed to enumerate devices:",e),[]}}async switchDevice(e){this.constraints.audio={...typeof this.constraints.audio=="object"?this.constraints.audio:{},deviceId:{exact:e}},await this.restart();}dispose(){this.stop(),super.dispose();}};var A=class extends h{constructor(e){super();t(this,"context");t(this,"inputNode");t(this,"masterVolume");t(this,"compressor");t(this,"limiter");t(this,"analyser");this.context=e,this.inputNode=this.context.createGain(),this.masterVolume=this.context.createGain(),this.compressor=this.context.createDynamicsCompressor(),this.compressor.threshold.value=-24,this.compressor.knee.value=30,this.compressor.ratio.value=12,this.compressor.attack.value=.003,this.compressor.release.value=.25,this.limiter=this.context.createDynamicsCompressor(),this.limiter.threshold.value=-0.5,this.limiter.knee.value=0,this.limiter.ratio.value=20,this.limiter.attack.value=.001,this.limiter.release.value=.01,this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048,this.inputNode.connect(this.compressor),this.compressor.connect(this.limiter),this.limiter.connect(this.masterVolume),this.masterVolume.connect(this.analyser),this.analyser.connect(this.context.destination);}getInput(){return this.inputNode}getOutput(){return this.context.destination}connect(e){this.analyser.connect(e.getInput());}setPrev(e){}disconnect(){try{this.analyser.disconnect();}catch{}}setVolume(e){e=Math.max(0,Math.min(1,e)),this.masterVolume.gain.value=e,this.emit("volumeChange",e);}getVolume(){return this.masterVolume.gain.value}mute(){this.masterVolume.gain.value=0,this.emit("mute");}unmute(){this.masterVolume.gain.value=1,this.emit("unmute");}setCompressorEnabled(e){if(e)try{this.inputNode.disconnect(),this.inputNode.connect(this.compressor);}catch{}else try{this.inputNode.disconnect(),this.inputNode.connect(this.limiter);}catch{}}setCompressorParams(e){e.threshold!==void 0&&(this.compressor.threshold.value=e.threshold),e.knee!==void 0&&(this.compressor.knee.value=e.knee),e.ratio!==void 0&&(this.compressor.ratio.value=e.ratio),e.attack!==void 0&&(this.compressor.attack.value=e.attack),e.release!==void 0&&(this.compressor.release.value=e.release);}getLevel(){let e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteTimeDomainData(e);let i=0;for(let o=0;o<e.length;o++){let n=Math.abs(e[o]-128)/128;n>i&&(i=n);}return i}getFrequencyData(){let e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteFrequencyData(e),e}getWaveformData(){let e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(e),e}connectDestination(e){this.analyser.connect(e);}disconnectDestination(e){try{this.analyser.disconnect(e);}catch{}}dispose(){try{this.inputNode.disconnect(),this.compressor.disconnect(),this.limiter.disconnect(),this.masterVolume.disconnect(),this.analyser.disconnect();}catch{}this.removeAllListeners();}};var S=class extends h{constructor(){super();t(this,"context");t(this,"board");t(this,"input");t(this,"output");t(this,"mediaStreamDestination");this.context=new(window.AudioContext||window.webkitAudioContext),this.input=new m(this.context),this.output=new A(this.context),this.context.addEventListener("statechange",()=>{this.emit("statechange",this.context.state);});}getContext(){return this.context}async resume(){this.context.state==="suspended"&&await this.context.resume();}setBoard(e){this.board&&(this.input.disconnect(),this.board.disconnect(),this.board.dispose()),this.board=e,this.mediaStreamDestination&&this.board.setMediaStreamDestination(this.mediaStreamDestination),this.route(),this.emit("boardChange",e);}getBoard(){return this.board}route(){this.board&&(this.input.disconnect(),this.input.connect(this.board),this.board.connect(this.output));}async play(e){this.input.stop(),this.input.disconnect();let i=new g(this.context,e);this.input=i,await new Promise((o,n)=>{i.once("loaded",()=>o()),i.once("error",d=>n(d));}),this.route(),i.play();}async playFile(e){this.input.stop(),this.input.disconnect();let i=new g(this.context);await i.loadFileObject(e),this.input=i,this.route(),i.play();}async startLiveInput(){this.input.stop(),this.input.disconnect();let e=new x(this.context,false);this.input=e,await e.startStream(),this.route();}stop(){this.input.stop();}setInput(e){this.input.stop(),this.input.disconnect(),this.input=e,this.route();}getInput(){return this.input}getOutput(){return this.output}setVolume(e){this.output.setVolume(e);}getVolume(){return this.output.getVolume()}setMediaStreamDestination(e){this.mediaStreamDestination=e,this.board&&this.board.setMediaStreamDestination(e);}createMediaStreamDestination(){let e=this.context.createMediaStreamDestination();return this.setMediaStreamDestination(e),e}getAnalysisData(){return {inputLevel:this.input instanceof x?this.input.getLevel():0,outputLevel:this.output.getLevel(),frequencyData:this.output.getFrequencyData(),waveformData:this.output.getWaveformData()}}dispose(){this.input.dispose(),this.output.dispose(),this.board&&this.board.dispose(),this.context.close(),this.removeAllListeners();}};var p=class{constructor(s){t(this,"context");t(this,"inputBuffer");t(this,"outputBuffer");t(this,"chain",[]);t(this,"effects",[]);t(this,"prev");t(this,"next");t(this,"disposed",false);this.context=s,this.inputBuffer=this.context.createGain(),this.outputBuffer=this.context.createGain();}connect(s){this.next=s,this.chain=[this.inputBuffer,...this.effects,this.outputBuffer,this.next].filter(Boolean),this.routeInternal();}getInput(){return this.inputBuffer}getOutput(){return this.outputBuffer}setPrev(s){this.prev=s;}routeInternal(){let s=this.chain;s.forEach(e=>{try{e.disconnect();}catch{}});for(let e=0;e<s.length-1;e++)try{s[e].connect(s[e+1]);}catch(i){console.error("Error connecting audio nodes:",i);}}disconnect(){try{this.outputBuffer.disconnect();}catch{}}dispose(){this.disposed||(this.disconnect(),this.chain=[],this.effects=[],this.disposed=true);}};var f=class extends h{constructor(e,i=p){super();t(this,"model");t(this,"context");t(this,"components",[]);this.context=e,this.model=new i(e),this.createChildComponents(),this.bindModelEvents();}createChildComponents(){this.components=[];}bindModelEvents(){}getInput(){return this.model.getInput()}getOutput(){return this.model.getOutput()}setPrev(e){this.model.setPrev(e.getOutput());}connect(e){e.setPrev(this),this.model.connect(e.getInput());}disconnect(){this.model.disconnect();}dispose(){this.components.forEach(e=>{e.dispose&&e.dispose();}),this.model.dispose(),this.removeAllListeners();}};var B=class extends f{constructor(e){super(e,p);t(this,"pedals",[]);t(this,"mediaStreamDestination");}addPedals(e){e.forEach(i=>this.addPedal(i));}addPedal(e){this.pedals.push(e),this.routeInternal();}addPedalAt(e,i){this.pedals.splice(i,0,e),this.routeInternal();}removePedal(e){let i=this.pedals.indexOf(e);i!==-1&&(this.pedals.splice(i,1),e.disconnect(),this.routeInternal());}removePedalAt(e){if(e>=0&&e<this.pedals.length){let i=this.pedals.splice(e,1)[0];return i.disconnect(),this.routeInternal(),i}}getPedals(){return [...this.pedals]}getPedalAt(e){return this.pedals[e]}movePedal(e,i){if(e>=0&&e<this.pedals.length&&i>=0&&i<this.pedals.length){let o=this.pedals.splice(e,1)[0];this.pedals.splice(i,0,o),this.routeInternal();}}routeInternal(){this.pedals.forEach(e=>e.disconnect());try{this.model.inputBuffer.disconnect(),this.model.outputBuffer.disconnect();}catch{}if(this.pedals.length===0)this.model.inputBuffer.connect(this.model.outputBuffer);else {this.model.inputBuffer.connect(this.pedals[0].getInput());for(let i=0;i<this.pedals.length-1;i++)this.pedals[i].connect(this.pedals[i+1]);this.pedals[this.pedals.length-1].getOutput().connect(this.model.outputBuffer);}this.mediaStreamDestination&&this.model.outputBuffer.connect(this.mediaStreamDestination);}setMediaStreamDestination(e){this.mediaStreamDestination=e,this.routeInternal();}clear(){this.pedals.forEach(e=>e.disconnect()),this.pedals=[],this.routeInternal();}dispose(){this.pedals.forEach(e=>e.dispose()),this.pedals=[],super.dispose();}toJSON(){return {pedals:this.pedals.map(e=>({name:e.name,bypassed:e.isBypassed(),pots:e.pots.map(i=>({name:i.getName(),value:i.getValue()}))}))}}};var u=class extends p{constructor(e){super(e);t(this,"level");t(this,"nodes",[]);this.level=this.context.createGain(),this.level.gain.value=1,this.effects.push(this.level);}setLevel(e){e=Math.min(Math.max(e,0),10),this.level.gain.value=e/10;}routeInternal(){super.routeInternal(),this.effects.length>0&&(this.nodes=[[this.effects[0],this.inputBuffer,this.outputBuffer],[this.outputBuffer,this.effects[this.effects.length-1],null]]);}enable(){this.routeInternal();}bypass(){try{this.inputBuffer.disconnect(),this.effects.forEach(e=>{try{e.disconnect();}catch{}}),this.inputBuffer.connect(this.outputBuffer),this.next&&this.outputBuffer.connect(this.next);}catch(e){console.error("Error bypassing effect:",e);}}};var v=class extends h{constructor(e,i,o=1,n=0,d){super();t(this,"value",0);t(this,"min");t(this,"max");t(this,"step");t(this,"name");t(this,"handler");t(this,"audioParam");this.name=i,this.min=n,this.max=d??n+o,this.step=(this.max-this.min)/100,e instanceof AudioParam?(this.audioParam=e,this.handler=l=>{this.audioParam.value=l;}):this.handler=e;}setValue(e){e=Math.max(0,Math.min(1,e));let i=this.value;this.value=this.mapValue(e),this.handler&&this.handler(this.value),this.emit("change",{value:this.value,normalizedValue:e,oldValue:i});}setActualValue(e){e=Math.max(this.min,Math.min(this.max,e));let i=(e-this.min)/(this.max-this.min);this.setValue(i);}getValue(){return this.value}getNormalizedValue(){return (this.value-this.min)/(this.max-this.min)}getConfig(){return {value:this.value,min:this.min,max:this.max,step:this.step}}getName(){return this.name}};var a=class extends v{mapValue(s){return this.min+s*(this.max-this.min)}};var b=class extends h{constructor(e,i=false){super();t(this,"state",false);t(this,"name");t(this,"nodes");this.name=e,this.state=i;}setState(e){this.state!==e&&(this.state=e,this.emit("change",e),this.emit(e?"on":"off"),this.routeNodes());}getState(){return this.state}setNodes(e){this.nodes=e,this.routeNodes();}routeNodes(){this.nodes&&this.nodes.forEach(e=>{let[i,o,n]=e;try{o.disconnect(),this.state?o.connect(i):n&&o.connect(n);}catch{}});}getConfig(){return {on:this.state,momentary:this.isMomentary()}}getName(){return this.name}};var N=class extends b{toggle(){this.setState(!this.state);}isMomentary(){return  false}};var M=class extends h{constructor(e){super();t(this,"switch");t(this,"state",false);this.switch=e,this.switch.on("change",i=>{this.setState(i);}),this.setState(this.switch.getState());}setState(e){this.state!==e&&(this.state=e,this.emit("change",e));}getState(){return this.state}isOn(){return this.state}isOff(){return !this.state}};var c=class extends f{constructor(e,i=u){super(e,i);t(this,"volumePot");t(this,"bypassSwitch");t(this,"led");t(this,"pots",[]);t(this,"switches",[]);t(this,"leds",[]);this.model=new i(e);}createPots(){this.volumePot=new a(e=>this.model.setLevel(e),"volume",1,0,10),this.volumePot.setValue(10),this.pots=[this.volumePot];}createSwitches(){this.bypassSwitch=new N("bypass"),this.led=new M(this.bypassSwitch),this.leds=[this.led],this.switches=[this.bypassSwitch],this.bypassSwitch.on("change",e=>{e?this.model.enable():this.model.bypass(),setTimeout(()=>{e?this.model.enable():this.model.bypass();},10);});}createChildComponents(){this.createPots(),this.createSwitches();}connect(e){super.connect(e),this.bypassSwitch&&this.model.nodes&&this.bypassSwitch.setNodes(this.model.nodes);}setLevel(e){this.volumePot.setValue(e);}getLevel(){return this.volumePot.getValue()}toggleBypass(){this.bypassSwitch.toggle();}setBypass(e){this.bypassSwitch.setState(!e);}isBypassed(){return !this.bypassSwitch.getState()}};var C=class extends u{constructor(e){super(e);t(this,"waveShaper");t(this,"lowPass");t(this,"lowPassFreq",3e3);t(this,"driveAmount",0);this.lowPass=this.context.createBiquadFilter(),this.lowPass.type="lowpass",this.lowPass.frequency.value=this.lowPassFreq,this.waveShaper=this.context.createWaveShaper(),this.waveShaper.oversample="4x",this.effects=[this.waveShaper,this.lowPass,this.level],this.createWSCurve(0);}createWSCurve(e){let i=e,o=22050,n=new Float32Array(o),d=Math.PI/180;for(let l=0;l<o;l++){let w=l*2/o-1;n[l]=(3+i)*w*20*d/(Math.PI+i*Math.abs(w));}this.waveShaper.curve=n;}setDrive(e){this.driveAmount=Math.max(0,Math.min(10,e)),this.createWSCurve(this.driveAmount*10);}setTone(e){e=Math.max(0,Math.min(10,e)),this.lowPass.frequency.value=200+e*480;}getDrive(){return this.driveAmount}getTone(){return this.lowPass.frequency.value}};var P=class extends v{mapValue(s){let e=Math.log10(.001),i=Math.log10(1),o=e+s*(i-e),n=Math.pow(10,o);return this.min+n*(this.max-this.min)}};var D=class extends c{constructor(e){super(e,C);t(this,"name","overdrive");t(this,"drivePot");t(this,"tonePot");}createPots(){super.createPots(),this.drivePot=new P(e=>this.model.setDrive(e),"drive",10,0,10),this.tonePot=new P(e=>this.model.setTone(e),"tone",10,0,10),this.pots.push(this.drivePot,this.tonePot),this.drivePot.setActualValue(2),this.tonePot.setActualValue(5);}setDrive(e){this.drivePot.setActualValue(e);}getDrive(){return this.drivePot.getValue()}setTone(e){this.tonePot.setActualValue(e);}getTone(){return this.tonePot.getValue()}};var V=class extends u{constructor(e){super(e);t(this,"delay");t(this,"feedback");t(this,"wetGain");t(this,"dryGain");t(this,"maxDelayTime",2);this.delay=this.context.createDelay(this.maxDelayTime),this.delay.delayTime.value=.3,this.feedback=this.context.createGain(),this.feedback.gain.value=.4,this.wetGain=this.context.createGain(),this.wetGain.gain.value=.5,this.dryGain=this.context.createGain(),this.dryGain.gain.value=1,this.delay.connect(this.feedback),this.feedback.connect(this.delay),this.delay.connect(this.wetGain),this.wetGain.connect(this.level),this.dryGain.connect(this.level),this.effects=[this.dryGain,this.delay,this.level];}routeInternal(){try{this.inputBuffer.disconnect(),this.dryGain.disconnect(),this.delay.disconnect(),this.wetGain.disconnect(),this.level.disconnect(),this.outputBuffer.disconnect();}catch{}this.inputBuffer.connect(this.dryGain),this.dryGain.connect(this.level),this.inputBuffer.connect(this.delay),this.delay.connect(this.wetGain),this.delay.connect(this.feedback),this.feedback.connect(this.delay),this.wetGain.connect(this.level),this.level.connect(this.outputBuffer),this.next&&this.outputBuffer.connect(this.next),this.nodes=[[this.dryGain,this.inputBuffer,this.outputBuffer],[this.outputBuffer,this.level,null]];}setDelayTime(e){e=Math.max(0,Math.min(this.maxDelayTime,e)),this.delay.delayTime.value=e;}setFeedback(e){e=Math.max(0,Math.min(.95,e)),this.feedback.gain.value=e;}setMix(e){e=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=e,this.dryGain.gain.value=1-e*.5;}getDelayTime(){return this.delay.delayTime.value}getFeedback(){return this.feedback.gain.value}getMix(){return this.wetGain.gain.value}};var I=class extends c{constructor(e){super(e,V);t(this,"name","delay");t(this,"timePot");t(this,"feedbackPot");t(this,"mixPot");}createPots(){super.createPots(),this.timePot=new a(e=>this.model.setDelayTime(e),"time",2,0,2),this.feedbackPot=new a(e=>this.model.setFeedback(e),"feedback",.95,0,.95),this.mixPot=new a(e=>this.model.setMix(e),"mix",1,0,1),this.pots.push(this.timePot,this.feedbackPot,this.mixPot),this.timePot.setActualValue(.3),this.feedbackPot.setActualValue(.4),this.mixPot.setActualValue(.5);}setDelayTimer(e){e=e/10*2,this.timePot.setActualValue(e);}setFeedbackGain(e){e=e/10*.95,this.feedbackPot.setActualValue(e);}setMix(e){e=e/10,this.mixPot.setActualValue(e);}getDelayTime(){return this.timePot.getValue()}getFeedback(){return this.feedbackPot.getValue()}getMix(){return this.mixPot.getValue()}};var G=class extends u{constructor(e){super(e);t(this,"convolver");t(this,"wetGain");t(this,"dryGain");t(this,"impulseBuffer");this.convolver=this.context.createConvolver(),this.wetGain=this.context.createGain(),this.wetGain.gain.value=.3,this.dryGain=this.context.createGain(),this.dryGain.gain.value=.7,this.generateImpulse(2,2,.5),this.convolver.connect(this.wetGain),this.wetGain.connect(this.level),this.dryGain.connect(this.level),this.effects=[this.dryGain,this.convolver,this.level];}generateImpulse(e,i,o){let n=this.context.sampleRate*e,d=this.context.createBuffer(2,n,this.context.sampleRate);for(let l=0;l<2;l++){let w=d.getChannelData(l);for(let y=0;y<n;y++){let E=(Math.random()*2-1)*Math.pow(1-y/n,i);o<1&&y>0&&(E=E*o+w[y-1]*(1-o)),w[y]=E;}}this.impulseBuffer=d,this.convolver.buffer=d;}routeInternal(){try{this.inputBuffer.disconnect(),this.dryGain.disconnect(),this.convolver.disconnect(),this.wetGain.disconnect(),this.level.disconnect(),this.outputBuffer.disconnect();}catch{}this.inputBuffer.connect(this.dryGain),this.dryGain.connect(this.level),this.inputBuffer.connect(this.convolver),this.convolver.connect(this.wetGain),this.wetGain.connect(this.level),this.level.connect(this.outputBuffer),this.next&&this.outputBuffer.connect(this.next),this.nodes=[[this.dryGain,this.inputBuffer,this.outputBuffer],[this.outputBuffer,this.level,null]];}setRoomSize(e){e=Math.max(0,Math.min(10,e));let i=.5+e/10*3.5,o=2+e/10*2;this.generateImpulse(i,o,.5);}setMix(e){e=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=e,this.dryGain.gain.value=1-e*.7;}setBrightness(e){e=Math.max(0,Math.min(10,e));let i=this.impulseBuffer?this.impulseBuffer.duration:2;this.generateImpulse(i,2,e/10);}async loadImpulse(e){try{let o=await(await fetch(e)).arrayBuffer(),n=await this.context.decodeAudioData(o);this.impulseBuffer=n,this.convolver.buffer=n;}catch(i){console.error("Failed to load impulse response:",i),this.generateImpulse(2,2,.5);}}};var k=class extends c{constructor(e){super(e,G);t(this,"name","reverb");t(this,"roomSizePot");t(this,"mixPot");t(this,"brightnessPot");}createPots(){super.createPots(),this.roomSizePot=new a(e=>this.model.setRoomSize(e),"room",10,0,10),this.mixPot=new a(e=>this.model.setMix(e),"mix",1,0,1),this.brightnessPot=new a(e=>this.model.setBrightness(e),"tone",10,0,10),this.pots.push(this.roomSizePot,this.mixPot,this.brightnessPot),this.roomSizePot.setActualValue(5),this.mixPot.setActualValue(.3),this.brightnessPot.setActualValue(5);}setRoomSize(e){this.roomSizePot.setActualValue(e);}setLevel(e){this.mixPot.setActualValue(e/10);}setBrightness(e){this.brightnessPot.setActualValue(e);}async loadImpulse(e){await this.model.loadImpulse(e);}};var T=class extends u{constructor(s){super(s),this.effects=[this.level];}setVolume(s){this.setLevel(s);}getVolume(){return this.level.gain.value*10}};var q=class extends c{constructor(e){super(e,T);t(this,"name","volume");}createPots(){super.createPots(),this.volumePot.setActualValue(10);}setVolume(e){this.volumePot.setActualValue(e);}getVolume(){return this.volumePot.getValue()}};var L=class extends u{constructor(e){super(e);t(this,"lowShelf");t(this,"highShelf");t(this,"midPeak");t(this,"lowPass");t(this,"highPass");t(this,"cabinetType","vintage");this.highPass=this.context.createBiquadFilter(),this.highPass.type="highpass",this.highPass.frequency.value=80,this.highPass.Q.value=.7,this.lowShelf=this.context.createBiquadFilter(),this.lowShelf.type="lowshelf",this.lowShelf.frequency.value=200,this.lowShelf.gain.value=-2,this.midPeak=this.context.createBiquadFilter(),this.midPeak.type="peaking",this.midPeak.frequency.value=800,this.midPeak.Q.value=.5,this.midPeak.gain.value=3,this.highShelf=this.context.createBiquadFilter(),this.highShelf.type="highshelf",this.highShelf.frequency.value=3e3,this.highShelf.gain.value=-4,this.lowPass=this.context.createBiquadFilter(),this.lowPass.type="lowpass",this.lowPass.frequency.value=5e3,this.lowPass.Q.value=.7,this.effects=[this.highPass,this.lowShelf,this.midPeak,this.highShelf,this.lowPass,this.level],this.setCabinetType("vintage");}setCabinetType(e){switch(this.cabinetType=e,e){case "vintage":this.highPass.frequency.value=80,this.lowShelf.frequency.value=200,this.lowShelf.gain.value=-2,this.midPeak.frequency.value=800,this.midPeak.gain.value=3,this.highShelf.frequency.value=3e3,this.highShelf.gain.value=-4,this.lowPass.frequency.value=5e3;break;case "modern":this.highPass.frequency.value=60,this.lowShelf.frequency.value=150,this.lowShelf.gain.value=2,this.midPeak.frequency.value=500,this.midPeak.gain.value=-3,this.highShelf.frequency.value=4e3,this.highShelf.gain.value=2,this.lowPass.frequency.value=8e3;break;case "british":this.highPass.frequency.value=100,this.lowShelf.frequency.value=250,this.lowShelf.gain.value=-3,this.midPeak.frequency.value=1200,this.midPeak.gain.value=5,this.highShelf.frequency.value=2500,this.highShelf.gain.value=-2,this.lowPass.frequency.value=6e3;break;case "custom":this.highPass.frequency.value=20,this.lowShelf.gain.value=0,this.midPeak.gain.value=0,this.highShelf.gain.value=0,this.lowPass.frequency.value=2e4;break}}setBass(e){e=Math.max(0,Math.min(10,e)),this.lowShelf.gain.value=(e-5)*2;}setMid(e){e=Math.max(0,Math.min(10,e)),this.midPeak.gain.value=(e-5)*2;}setTreble(e){e=Math.max(0,Math.min(10,e)),this.highShelf.gain.value=(e-5)*2;}setPresence(e){e=Math.max(0,Math.min(10,e)),this.lowPass.frequency.value=3e3+e*500;}getCabinetType(){return this.cabinetType}};var F=class extends c{constructor(e){super(e,L);t(this,"name","cabinet");t(this,"bassPot");t(this,"midPot");t(this,"treblePot");t(this,"presencePot");}createPots(){super.createPots(),this.bassPot=new a(e=>this.model.setBass(e),"bass",10,0,10),this.midPot=new a(e=>this.model.setMid(e),"mid",10,0,10),this.treblePot=new a(e=>this.model.setTreble(e),"treble",10,0,10),this.presencePot=new a(e=>this.model.setPresence(e),"presence",10,0,10),this.pots.push(this.bassPot,this.midPot,this.treblePot,this.presencePot),this.bassPot.setActualValue(5),this.midPot.setActualValue(5),this.treblePot.setActualValue(5),this.presencePot.setActualValue(5);}setCabinetType(e){this.model.setCabinetType(e);}setBass(e){this.bassPot.setActualValue(e);}setMid(e){this.midPot.setActualValue(e);}setTreble(e){this.treblePot.setActualValue(e);}setPresence(e){this.presencePot.setActualValue(e);}};var O=class extends b{constructor(){super(...arguments);t(this,"pressTimer");}press(){this.setState(true);}release(){this.setState(false);}toggle(){this.pressTimer&&clearTimeout(this.pressTimer),this.press(),this.pressTimer=setTimeout(()=>{this.release();},100);}isMomentary(){return  true}dispose(){this.pressTimer&&clearTimeout(this.pressTimer);}};var Ot={Stage:S,Board:B,pedals:{Overdrive:D,Delay:I,Reverb:k,Volume:q,Cabinet:F}};exports.Board=B;exports.Box=c;exports.BoxModel=u;exports.Cabinet=F;exports.CabinetModel=L;exports.Connectable=f;exports.ConnectableModel=p;exports.Delay=I;exports.DelayModel=V;exports.EventEmitter=h;exports.FileInput=g;exports.Input=m;exports.Led=M;exports.LinearPot=a;exports.LogPot=P;exports.MomentarySwitch=O;exports.Output=A;exports.Overdrive=D;exports.OverdriveModel=C;exports.Pot=v;exports.Reverb=k;exports.ReverbModel=G;exports.Stage=S;exports.StreamInput=x;exports.Switch=b;exports.ToggleSwitch=N;exports.Volume=q;exports.VolumeModel=T;exports.default=Ot;//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map